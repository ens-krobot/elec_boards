<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Carte capteurs: Référence du fichier rangefinder.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="classes.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Référence du fichier rangefinder.h</h1>Gère la télémétrie. <a href="#_details">Plus de détails...</a>
<p>
<code>#include &lt;timers.h&gt;</code><br>
<code>#include &lt;delays.h&gt;</code><br>
<code>#include &quot;<a class="el" href="_generic_type_defs_8h.html">GenericTypeDefs.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_compiler_8h.html">Compiler.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_hardware_profile_8h.html">HardwareProfile.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="eeprom_8h.html">eeprom.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_pc_interface_8h.html">../PcInterface.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Graphe des dépendances par inclusion de rangefinder.h:</div>
<div class="dynsection">
<p><center><img src="rangefinder_8h__incl.png" border="0" usemap="#rangefinder.h_map" alt=""></center>
<map name="rangefinder.h_map">
<area shape="rect" href="_generic_type_defs_8h.html" title="GenericTypeDefs.h" alt="" coords="139,160,301,189"><area shape="rect" href="_compiler_8h.html" title="Compiler.h" alt="" coords="325,160,424,189"><area shape="rect" href="_hardware_profile_8h.html" title="Définitions spécifiques au PIC utilisé, pour l&#39;USB et les LEDs notamment." alt="" coords="376,83,528,112"><area shape="rect" href="eeprom_8h.html" title="Fonctions de lecture et d&#39;écriture avec l&#39;EEPROM du PIC." alt="" coords="211,83,301,112"><area shape="rect" href="_pc_interface_8h.html" title="Fichier commun avec le programme hôte sur la carte mère (USB PC)." alt="" coords="552,83,688,112"></map>
</div>

<p>
<div class="dynheader">
Ce graphe montre quels fichiers incluent directement ou indirectement ce fichier :</div>
<div class="dynsection">
<p><center><img src="rangefinder_8h__dep__incl.png" border="0" usemap="#rangefinder.hdep_map" alt=""></center>
<map name="rangefinder.hdep_map">
<area shape="rect" href="main_8c.html" title="Contient la fonction main() du programme." alt="" coords="5,83,75,112"><area shape="rect" href="rangefinder_8c.html" title="Gère la télémétrie." alt="" coords="99,83,219,112"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Macros</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#185b4dd6ffe8f2446d26cde1a059f740">MAX_PULSE</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Nombre de périodes dans la trame d'émission [default: 10].  <a href="#185b4dd6ffe8f2446d26cde1a059f740"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#59d59e749de9b8a9ca3375ecea243a3d">PULSE_FREQ</a>&nbsp;&nbsp;&nbsp;40000</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fréquence de la trame d'émission (en Hz) [default: 340].  <a href="#59d59e749de9b8a9ca3375ecea243a3d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#2b507902afdd3115802269d47bdfff22">DELAY_RCPT</a>&nbsp;&nbsp;&nbsp;100</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Délais avant de passer au télémètre suivant (en us) [default: 100].  <a href="#2b507902afdd3115802269d47bdfff22"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041">RCPT_TIMER_PER</a>&nbsp;&nbsp;&nbsp;500</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Période de comptage du temps écoulé, pour la réception (en us) [default: 500].  <a href="#f3860d3c90ead4844e530b8cff74a041"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#afcb3658731991cf3037f912d65b64e9">RCPT_MAX_DELAY</a>&nbsp;&nbsp;&nbsp;18000</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Délais d'attente maximale à la réception (en us) [default: 18000].  <a href="#afcb3658731991cf3037f912d65b64e9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#3afa8280a6e227717cc718148289b948">START_THRESHOLD</a>&nbsp;&nbsp;&nbsp;(ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 1))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#a3c9d5bc3f1c3dfec69046200aecb29a">MIN_THRESHOLD</a>&nbsp;&nbsp;&nbsp;(ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 2))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#97afb20d1630e78fe4a72dd53bf03c92">DELAY_PULSE</a>&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 3)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 4))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#e73d78f8ad1955fc7efc65b109987632">SOUND_SPEED</a>&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 5)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 6))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#1798dcdbfe664345eadd340c38ca4a34">MEAS_OFFSET</a>&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 7)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 8))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#4ef793b4e15b3cbbe747af8e5eaf05e7">EN_DYN_THRESHOLD</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Si non commenté, active le seuil dynamique.  <a href="#4ef793b4e15b3cbbe747af8e5eaf05e7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#834d53e3b7adf1c8a94e6543e033e290">THRESHOLD_STEP</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pas de diminution du seuil, tous les RCPT_TIMER_PER (uniquement avec seuil dynamique).  <a href="#834d53e3b7adf1c8a94e6543e033e290"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a>&nbsp;&nbsp;&nbsp;(CLOCK_FREQ / 4.0)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#bd6756ef3ae5fbf8778baa708a874027">ADDR0</a>&nbsp;&nbsp;&nbsp;PORTDbits.RD3</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bit 0 d'adresse du télémètre.  <a href="#bd6756ef3ae5fbf8778baa708a874027"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#9897c4845eb36c5242bfeb12bba79d5c">ADDR1</a>&nbsp;&nbsp;&nbsp;PORTDbits.RD2</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bit 1 d'adresse du télémètre.  <a href="#9897c4845eb36c5242bfeb12bba79d5c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#f72b69397a00971f5f6ee4b2ac5a4735">ADDR2</a>&nbsp;&nbsp;&nbsp;PORTCbits.RC6</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bit 2 d'adresse du télémètre.  <a href="#f72b69397a00971f5f6ee4b2ac5a4735"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#70c5ad4e1fc5bcfafdc0f64434fb1c8f">EM_EN</a>&nbsp;&nbsp;&nbsp;PORTDbits.RD7</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal ENABLE du circuit d'émission.  <a href="#70c5ad4e1fc5bcfafdc0f64434fb1c8f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#0d30fcd95933784ad82131355571f495">RCPT_EN</a>&nbsp;&nbsp;&nbsp;PORTDbits.RD6</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal ENABLE du circuit de réception.  <a href="#0d30fcd95933784ad82131355571f495"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#3953e33787d9ae7c067bda9e47d1bf51">PULSE</a>&nbsp;&nbsp;&nbsp;PORTDbits.RD5</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal PULSE pour l'envoie de trames.  <a href="#3953e33787d9ae7c067bda9e47d1bf51"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#d5357a5cc43a498c85b113357923f8aa">MODE_MEASURE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#fe12ca5e671c24d97d5daa9f104b60fb">MODE_CALIBRATE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#b2ccc17e75486345af1d9d23a032a6e2">initRangefinder</a>()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialise l'interface avec le système de télémétrie.  <a href="#b2ccc17e75486345af1d9d23a032a6e2"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Fonctions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#6b4d1fc9568f6e793c984abb77701cb8">interruptRangefinder</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fonction d'interruption pour le télémètre.  <a href="#6b4d1fc9568f6e793c984abb77701cb8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#efe3164ab7224e74c49438f63c56caa2">interruptRangefinder2</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fonction d'interruption pour le télémètre.  <a href="#efe3164ab7224e74c49438f63c56caa2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_generic_type_defs_8h.html#54d65c7fa62e62c9754371e42f5111b9">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#7782486c96b2ff62dab69f99636a861e">measureDistance</a> (char addr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mesure une distance sur un télémètre.  <a href="#7782486c96b2ff62dab69f99636a861e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#438675a7ef66fd328e56e27a7bff362f">selectRangefinder</a> (char addr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sélection d'un télémètre.  <a href="#438675a7ef66fd328e56e27a7bff362f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#6d00149bf7ccb02aed245c211ce25826">sendPulse</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Envoie une impulsion ultrason.  <a href="#6d00149bf7ccb02aed245c211ce25826"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#905b1f6dd68931ac8abb5db4dac699bd">getMeasuredDist</a> (char addr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Donne la distance mesurée pour un télémètre.  <a href="#905b1f6dd68931ac8abb5db4dac699bd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_generic_type_defs_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#6af556b86bdcad857be2fbe2599bcde4">calibrate</a> (char addr, <a class="el" href="_generic_type_defs_8h.html#54d65c7fa62e62c9754371e42f5111b9">BOOL</a> skipMeas)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fonction de calibration semi-automatique d'un télémètre.  <a href="#6af556b86bdcad857be2fbe2599bcde4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#00ea98b79ae4bcb70342d4389d33ae31">quickSelect</a> (long arr[], int n)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Description détaillée</h2>
Gère la télémétrie. 
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">À faire:</a></b></dt><dd><ul>
<li>Fonctions de calibration<ul>
<li>Moyennage de la distance </li></ul>
</li></ul>
</dd></dl>
<hr><h2>Documentation des macros</h2>
<a class="anchor" name="bd6756ef3ae5fbf8778baa708a874027"></a><!-- doxytag: member="rangefinder.h::ADDR0" ref="bd6756ef3ae5fbf8778baa708a874027" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADDR0&nbsp;&nbsp;&nbsp;PORTDbits.RD3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Bit 0 d'adresse du télémètre. 
<p>

</div>
</div><p>
<a class="anchor" name="9897c4845eb36c5242bfeb12bba79d5c"></a><!-- doxytag: member="rangefinder.h::ADDR1" ref="9897c4845eb36c5242bfeb12bba79d5c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADDR1&nbsp;&nbsp;&nbsp;PORTDbits.RD2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Bit 1 d'adresse du télémètre. 
<p>

</div>
</div><p>
<a class="anchor" name="f72b69397a00971f5f6ee4b2ac5a4735"></a><!-- doxytag: member="rangefinder.h::ADDR2" ref="f72b69397a00971f5f6ee4b2ac5a4735" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADDR2&nbsp;&nbsp;&nbsp;PORTCbits.RC6          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Bit 2 d'adresse du télémètre. 
<p>

</div>
</div><p>
<a class="anchor" name="08424215b748fd2db22798a03fd47330"></a><!-- doxytag: member="rangefinder.h::CYCLE_FREQ" ref="08424215b748fd2db22798a03fd47330" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CYCLE_FREQ&nbsp;&nbsp;&nbsp;(CLOCK_FREQ / 4.0)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="97afb20d1630e78fe4a72dd53bf03c92"></a><!-- doxytag: member="rangefinder.h::DELAY_PULSE" ref="97afb20d1630e78fe4a72dd53bf03c92" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELAY_PULSE&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 3)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 4))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="2b507902afdd3115802269d47bdfff22"></a><!-- doxytag: member="rangefinder.h::DELAY_RCPT" ref="2b507902afdd3115802269d47bdfff22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELAY_RCPT&nbsp;&nbsp;&nbsp;100          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Délais avant de passer au télémètre suivant (en us) [default: 100]. 
<p>

</div>
</div><p>
<a class="anchor" name="70c5ad4e1fc5bcfafdc0f64434fb1c8f"></a><!-- doxytag: member="rangefinder.h::EM_EN" ref="70c5ad4e1fc5bcfafdc0f64434fb1c8f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EM_EN&nbsp;&nbsp;&nbsp;PORTDbits.RD7          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal ENABLE du circuit d'émission. 
<p>

</div>
</div><p>
<a class="anchor" name="4ef793b4e15b3cbbe747af8e5eaf05e7"></a><!-- doxytag: member="rangefinder.h::EN_DYN_THRESHOLD" ref="4ef793b4e15b3cbbe747af8e5eaf05e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EN_DYN_THRESHOLD          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Si non commenté, active le seuil dynamique. 
<p>
Le seuil dynamique permet d'augmenter la sensibilité de la détection à mesure que le temps - et donc la distance - augmente, ce qui permet d'augmenter la portée du télémètre tout en concervant une bon rapport signal à bruit pour les mesures de faibles distances. 
</div>
</div><p>
<a class="anchor" name="b2ccc17e75486345af1d9d23a032a6e2"></a><!-- doxytag: member="rangefinder.h::initRangefinder" ref="b2ccc17e75486345af1d9d23a032a6e2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define initRangefinder          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Valeur :</b><div class="fragment"><pre class="fragment">{                                                                                                                                                               \
        ADCON1&amp;= 0b11111011;                                                                                                                                                            \
        TRISC&amp;= 0b10111111;                                                                                                                                                                     \
        PORTC&amp;= 0b10111111;                                                                                                                                                                     \
        TRISD&amp;= 0b00010011;                                                                                                                                                                     \
        PORTD&amp;= 0b00010011;                                                                                                                                                                     \
        CMCON = 0b00010110;                                                                                                                                                                     \
        CVRCON = (0b10110000 | (<a class="code" href="rangefinder_8h.html#3afa8280a6e227717cc718148289b948">START_THRESHOLD</a> &amp; 0b1111));                                                                                                     \
}
</pre></div>Initialise l'interface avec le système de télémétrie. 
<p>
Cette commande ne doit être appelée qu'une seule fois au début du programme. 
</div>
</div><p>
<a class="anchor" name="185b4dd6ffe8f2446d26cde1a059f740"></a><!-- doxytag: member="rangefinder.h::MAX_PULSE" ref="185b4dd6ffe8f2446d26cde1a059f740" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PULSE&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Nombre de périodes dans la trame d'émission [default: 10]. 
<p>

</div>
</div><p>
<a class="anchor" name="1798dcdbfe664345eadd340c38ca4a34"></a><!-- doxytag: member="rangefinder.h::MEAS_OFFSET" ref="1798dcdbfe664345eadd340c38ca4a34" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MEAS_OFFSET&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 7)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 8))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="a3c9d5bc3f1c3dfec69046200aecb29a"></a><!-- doxytag: member="rangefinder.h::MIN_THRESHOLD" ref="a3c9d5bc3f1c3dfec69046200aecb29a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_THRESHOLD&nbsp;&nbsp;&nbsp;(ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 2))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="fe12ca5e671c24d97d5daa9f104b60fb"></a><!-- doxytag: member="rangefinder.h::MODE_CALIBRATE" ref="fe12ca5e671c24d97d5daa9f104b60fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODE_CALIBRATE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d5357a5cc43a498c85b113357923f8aa"></a><!-- doxytag: member="rangefinder.h::MODE_MEASURE" ref="d5357a5cc43a498c85b113357923f8aa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODE_MEASURE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3953e33787d9ae7c067bda9e47d1bf51"></a><!-- doxytag: member="rangefinder.h::PULSE" ref="3953e33787d9ae7c067bda9e47d1bf51" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PULSE&nbsp;&nbsp;&nbsp;PORTDbits.RD5          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal PULSE pour l'envoie de trames. 
<p>

</div>
</div><p>
<a class="anchor" name="59d59e749de9b8a9ca3375ecea243a3d"></a><!-- doxytag: member="rangefinder.h::PULSE_FREQ" ref="59d59e749de9b8a9ca3375ecea243a3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PULSE_FREQ&nbsp;&nbsp;&nbsp;40000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fréquence de la trame d'émission (en Hz) [default: 340]. 
<p>

</div>
</div><p>
<a class="anchor" name="0d30fcd95933784ad82131355571f495"></a><!-- doxytag: member="rangefinder.h::RCPT_EN" ref="0d30fcd95933784ad82131355571f495" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCPT_EN&nbsp;&nbsp;&nbsp;PORTDbits.RD6          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal ENABLE du circuit de réception. 
<p>

</div>
</div><p>
<a class="anchor" name="afcb3658731991cf3037f912d65b64e9"></a><!-- doxytag: member="rangefinder.h::RCPT_MAX_DELAY" ref="afcb3658731991cf3037f912d65b64e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCPT_MAX_DELAY&nbsp;&nbsp;&nbsp;18000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Délais d'attente maximale à la réception (en us) [default: 18000]. 
<p>

</div>
</div><p>
<a class="anchor" name="f3860d3c90ead4844e530b8cff74a041"></a><!-- doxytag: member="rangefinder.h::RCPT_TIMER_PER" ref="f3860d3c90ead4844e530b8cff74a041" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCPT_TIMER_PER&nbsp;&nbsp;&nbsp;500          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Période de comptage du temps écoulé, pour la réception (en us) [default: 500]. 
<p>

</div>
</div><p>
<a class="anchor" name="e73d78f8ad1955fc7efc65b109987632"></a><!-- doxytag: member="rangefinder.h::SOUND_SPEED" ref="e73d78f8ad1955fc7efc65b109987632" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SOUND_SPEED&nbsp;&nbsp;&nbsp;((((<a class="el" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 5)) &lt;&lt; 8) | ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 6))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3afa8280a6e227717cc718148289b948"></a><!-- doxytag: member="rangefinder.h::START_THRESHOLD" ref="3afa8280a6e227717cc718148289b948" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define START_THRESHOLD&nbsp;&nbsp;&nbsp;(ReadEEPROM(8*<a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> + 1))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="834d53e3b7adf1c8a94e6543e033e290"></a><!-- doxytag: member="rangefinder.h::THRESHOLD_STEP" ref="834d53e3b7adf1c8a94e6543e033e290" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define THRESHOLD_STEP&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pas de diminution du seuil, tous les RCPT_TIMER_PER (uniquement avec seuil dynamique). 
<p>

</div>
</div><p>
<hr><h2>Documentation des fonctions</h2>
<a class="anchor" name="6af556b86bdcad857be2fbe2599bcde4"></a><!-- doxytag: member="rangefinder.h::calibrate" ref="6af556b86bdcad857be2fbe2599bcde4" args="(char addr, BOOL skipMeas)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_generic_type_defs_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> calibrate           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_generic_type_defs_8h.html#54d65c7fa62e62c9754371e42f5111b9">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>skipMeas</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fonction de calibration semi-automatique d'un télémètre. 
<p>
<dl compact><dt><b>Paramètres:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>adresse du télémètre (de 0 à 7) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Renvoie:</b></dt><dd>status état de la calibration, peut valoir : <br>
 <a class="el" href="_pc_interface_8h.html#9b77ae51e68ff13de5c3187f9213de63">CAL_ERROR</a> Erreur survenue durant la calibration (calibration impossible) <br>
 <a class="el" href="_pc_interface_8h.html#b3a6812f76031ffc540dce45f0cb296d">CAL_CONTINUE</a> Demande de réappeler cette fonction pour poursuivre la calibration <br>
 <a class="el" href="_pc_interface_8h.html#5b3e1e1135d0ee281abc8da6512aeb3f">CAL_DONE</a> Calibration terminée <br>
 <a class="el" href="_pc_interface_8h.html#61c9f7089dc916208160b364c39bb1ec">CAL_PLACE_INF</a> Demande de placer le capteur loin de tout obstacle avant de réappeler cette fonction <br>
 <a class="el" href="_pc_interface_8h.html#1918d3513feff231a52562cb3536e68a">CAL_PLACE_30</a> Demande de placer le capteur à 30 cm d'un obstacle avant de réappeler cette fonction <br>
 <a class="el" href="_pc_interface_8h.html#b3b6643ad6e92c76b670f0ad22861d4b">CAL_PLACE_100</a> Demande de placer le capteur à 1 m d'un obstacle avant de réappeler cette fonction </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00235"></a>00235                                          {
<a name="l00236"></a>00236         <span class="keyword">static</span> <span class="keywordtype">char</span> state = 0;
<a name="l00237"></a>00237         <span class="keyword">static</span> <span class="keywordtype">char</span> measure = 0;
<a name="l00238"></a>00238         <span class="keyword">static</span> <span class="keywordtype">long</span> meas[5];
<a name="l00239"></a>00239         <span class="keyword">static</span> <span class="keywordtype">long</span> meas30, meas100;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <a class="code" href="union___w_o_r_d___v_a_l.html">WORD_VAL</a> delayPulse, slopeWord, originWord;
<a name="l00242"></a>00242         <a class="code" href="_generic_type_defs_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> threshold;
<a name="l00243"></a>00243         <span class="keywordtype">double</span> slope, origin;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="keywordflow">switch</span> (state) {
<a name="l00246"></a>00246                 <span class="keywordflow">case</span> 0:
<a name="l00247"></a>00247                         <span class="comment">// 0. Initialisation</span>
<a name="l00248"></a>00248                         <span class="comment">// On ne met pas les seuils aux max. pour se laisser une marge de manoeuvre par la suite</span>
<a name="l00249"></a>00249                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 1, 12);                                                    <span class="comment">// On commence par régler le seuil haut assez haut</span>
<a name="l00250"></a>00250                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 2, 12);                                                    <span class="comment">// Idem pour le seuil bas (= pas de calibration dynamique)</span>
<a name="l00251"></a>00251 
<a name="l00252"></a>00252                         delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = 20;                                                                    <span class="comment">// Pour commencer, on attend un temps minimal</span>
<a name="l00253"></a>00253                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 3, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00254"></a>00254                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 4, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256                         slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = 340;                                                                    <span class="comment">// Pente initiale = vitesse du son</span>
<a name="l00257"></a>00257                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 5, slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00258"></a>00258                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 6, slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                         originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = 0;                                                                             <span class="comment">// Offset initial nul</span>
<a name="l00261"></a>00261                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 7, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00262"></a>00262                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 8, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264                         state = 1;
<a name="l00265"></a>00265                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#61c9f7089dc916208160b364c39bb1ec">CAL_PLACE_INF</a>;
<a name="l00266"></a>00266                 <span class="keywordflow">break</span>;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                 <span class="keywordflow">case</span> 1:
<a name="l00269"></a>00269                         <span class="comment">// 1. Réglage du temps d'attente juste après l'émission</span>
<a name="l00270"></a>00270                         <span class="comment">// Objectif : le diminuer au maximum pour pouvoir faire des mesures au plus prêt du capteur.</span>
<a name="l00271"></a>00271                         <span class="comment">// Condition d'arrêt : détection erronée d'un obstacle proche.</span>
<a name="l00272"></a>00272                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre.">measureDistance</a>(addr)) {
<a name="l00273"></a>00273                                 meas[measure] = <a class="code" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre.">getMeasuredDist</a>(addr);
<a name="l00274"></a>00274                                 measure++;
<a name="l00275"></a>00275                         }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277                         <span class="keywordflow">if</span> (measure &gt;= 5) {
<a name="l00278"></a>00278                                 measure = 0;
<a name="l00279"></a>00279                                 delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a> = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 3);
<a name="l00280"></a>00280                                 delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a> = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 4);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282                                 <span class="keywordflow">if</span> (meas[0] &lt; 3000 || meas[1] &lt; 3000 || meas[2] &lt; 3000 || meas[3] &lt; 3000 || meas[4] &lt; 3000) {
<a name="l00283"></a>00283                                         <span class="comment">// Pas OK</span>
<a name="l00284"></a>00284                                         <span class="keywordflow">if</span> (delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> &gt;= 2000) {           <span class="comment">// &lt;=&gt; distance de 34 cm</span>
<a name="l00285"></a>00285                                                 <span class="comment">// On a déjà beaucoup attendu et pourtant il semble qu'il y ait encore du signal sur le transducteur.</span>
<a name="l00286"></a>00286                                                 <span class="comment">// =&gt; Peut-être faut-il augmenter le seuil via le potentiomètre sur la plaquette.</span>
<a name="l00287"></a>00287                                                 state = 0;
<a name="l00288"></a>00288                                                 <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#9b77ae51e68ff13de5c3187f9213de63">CAL_ERROR</a>;
<a name="l00289"></a>00289                                         }
<a name="l00290"></a>00290                                         <span class="keywordflow">else</span> {
<a name="l00291"></a>00291                                                 delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a>+= 20;
<a name="l00292"></a>00292                                                 <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 3, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00293"></a>00293                                                 <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 4, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00294"></a>00294                                         }
<a name="l00295"></a>00295                                 }
<a name="l00296"></a>00296                                 <span class="keywordflow">else</span> {
<a name="l00297"></a>00297                                         <span class="comment">// OK, mais on ajoute quand même une bonne marge de sécurité</span>
<a name="l00298"></a>00298                                         delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a>+= 40;
<a name="l00299"></a>00299                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 3, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00300"></a>00300                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 4, delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 1, 15);                                                    <span class="comment">// On met le seuil haut au maximum</span>
<a name="l00303"></a>00303                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 2, 15);                                                    <span class="comment">// Idem pour le seuil bas (= pas de calibration dynamique)</span>
<a name="l00304"></a>00304                                         state = 2;
<a name="l00305"></a>00305                                 }
<a name="l00306"></a>00306                         }
<a name="l00307"></a>00307                 <span class="keywordflow">break</span>;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309                 <span class="keywordflow">case</span> 2:
<a name="l00310"></a>00310                         <span class="comment">// 2. Réglage du seuil haut</span>
<a name="l00311"></a>00311                         <span class="comment">// Objectif : le diminuer au maximum pour la meilleure sensibilité.</span>
<a name="l00312"></a>00312                         <span class="comment">// Condition d'arrêt : détection erronée d'un obstacle proche.</span>
<a name="l00313"></a>00313                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre.">measureDistance</a>(addr)) {
<a name="l00314"></a>00314                                 meas[measure] = <a class="code" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre.">getMeasuredDist</a>(addr);
<a name="l00315"></a>00315                                 measure++;
<a name="l00316"></a>00316                         }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318                         <span class="keywordflow">if</span> (measure &gt;= 5) {
<a name="l00319"></a>00319                                 measure = 0;
<a name="l00320"></a>00320                                 threshold = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 1);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322                                 <span class="keywordflow">if</span> (meas[0] &lt; 3000 || meas[1] &lt; 3000 || meas[2] &lt; 3000 || meas[3] &lt; 3000 || meas[4] &lt; 3000) {
<a name="l00323"></a>00323                                         <span class="keywordflow">if</span> (threshold &gt;= 15) {
<a name="l00324"></a>00324                                                 <span class="comment">// Le seuil max. est atteint et on a encore un faux positif, on ne peut rien faire.</span>
<a name="l00325"></a>00325                                                 <span class="comment">// =&gt; il faudrait augmenter manuellement le seuil via le potentiomètre sur la plaquette.</span>
<a name="l00326"></a>00326                                                 state = 0;
<a name="l00327"></a>00327                                                 <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#9b77ae51e68ff13de5c3187f9213de63">CAL_ERROR</a>;
<a name="l00328"></a>00328                                         }
<a name="l00329"></a>00329                                         <span class="keywordflow">else</span> {
<a name="l00330"></a>00330                                                 <span class="comment">// On a trop baissé le seuil</span>
<a name="l00331"></a>00331                                                 threshold+= 3;                  <span class="comment">// On le remonte, avec une marge de sécurité</span>
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                                                 <span class="keywordflow">if</span> (threshold &gt; 15)
<a name="l00334"></a>00334                                                         threshold = 15;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336                                                 <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 1, threshold);
<a name="l00337"></a>00337                                         }
<a name="l00338"></a>00338                                 }
<a name="l00339"></a>00339                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (threshold &gt; 1) {
<a name="l00340"></a>00340                                         <span class="comment">// On peut encore baisser le seuil</span>
<a name="l00341"></a>00341                                         threshold--;
<a name="l00342"></a>00342                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 1, threshold);
<a name="l00343"></a>00343                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#b3a6812f76031ffc540dce45f0cb296d">CAL_CONTINUE</a>;
<a name="l00344"></a>00344                                 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346                                 state = 3;                              <span class="comment">// Passe à l'étape suivante</span>
<a name="l00347"></a>00347                         }
<a name="l00348"></a>00348                 <span class="keywordflow">break</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350                 <span class="keywordflow">case</span> 3:
<a name="l00351"></a>00351                         <span class="comment">// 3. Réglage du seuil bas</span>
<a name="l00352"></a>00352                         <span class="comment">// Objectif : le diminuer au maximum pour la meilleure sensibilité.</span>
<a name="l00353"></a>00353                         <span class="comment">// Condition d'arrêt : détection erronée d'un obstacle proche.</span>
<a name="l00354"></a>00354                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre.">measureDistance</a>(addr)) {
<a name="l00355"></a>00355                                 meas[measure] = <a class="code" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre.">getMeasuredDist</a>(addr);
<a name="l00356"></a>00356                                 measure++;
<a name="l00357"></a>00357                         }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359                         <span class="keywordflow">if</span> (measure &gt;= 5) {
<a name="l00360"></a>00360                                 measure = 0;
<a name="l00361"></a>00361                                 threshold = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 2);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363                                 <span class="keywordflow">if</span> (meas[0] &lt; 3000 || meas[1] &lt; 3000 || meas[2] &lt; 3000 || meas[3] &lt; 3000 || meas[4] &lt; 3000) {
<a name="l00364"></a>00364                                         <span class="keywordflow">if</span> (threshold &gt;= 15) {
<a name="l00365"></a>00365                                                 <span class="comment">// Le seuil max. est atteint et on a encore un faux positif, on ne peut rien faire.</span>
<a name="l00366"></a>00366                                                 <span class="comment">// =&gt; il faudrait augmenter manuellement le seuil via le potentiomètre sur la plaquette.</span>
<a name="l00367"></a>00367                                                 state = 0;
<a name="l00368"></a>00368                                                 <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#9b77ae51e68ff13de5c3187f9213de63">CAL_ERROR</a>;
<a name="l00369"></a>00369                                         }
<a name="l00370"></a>00370                                         <span class="keywordflow">else</span> {
<a name="l00371"></a>00371                                                 <span class="comment">// On a trop baissé le seuil</span>
<a name="l00372"></a>00372                                                 threshold+= 3;                  <span class="comment">// On le remonte, avec une marge de sécurité</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374                                                 <span class="keywordflow">if</span> (threshold &gt; 15)
<a name="l00375"></a>00375                                                         threshold = 15;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                                                 <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 2, threshold);
<a name="l00378"></a>00378                                         }
<a name="l00379"></a>00379                                 }
<a name="l00380"></a>00380                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (threshold &gt; 1) {
<a name="l00381"></a>00381                                         <span class="comment">// On peut encore baisser le seuil</span>
<a name="l00382"></a>00382                                         threshold--;
<a name="l00383"></a>00383                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 2, threshold);
<a name="l00384"></a>00384                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#b3a6812f76031ffc540dce45f0cb296d">CAL_CONTINUE</a>;
<a name="l00385"></a>00385                                 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387                                 <span class="keywordflow">if</span> (skipMeas) {
<a name="l00388"></a>00388                                         <span class="comment">// Si on a pas envie de faire des mesures précises, on évalue au mieux l'offset et on termine la calibration</span>
<a name="l00389"></a>00389                                         delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a> = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 3);
<a name="l00390"></a>00390                                         delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a> = <a class="code" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&amp;#39;EEPROM du PIC.">ReadEEPROM</a>(8*addr + 4);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392                                         originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = (<a class="code" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) (340.0 / 2.0 * (1e6 * <a class="code" href="rangefinder_8h.html#185b4dd6ffe8f2446d26cde1a059f740" title="Nombre de périodes dans la trame d&amp;#39;émission [default: 10].">MAX_PULSE</a> / <a class="code" href="rangefinder_8h.html#59d59e749de9b8a9ca3375ecea243a3d" title="Fréquence de la trame d&amp;#39;émission (en Hz) [default: 340].">PULSE_FREQ</a> + delayPulse.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a>) / 1000.0);
<a name="l00393"></a>00393                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 7, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00394"></a>00394                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 8, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                                         state = 0;
<a name="l00397"></a>00397                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#5b3e1e1135d0ee281abc8da6512aeb3f">CAL_DONE</a>;
<a name="l00398"></a>00398                                 }
<a name="l00399"></a>00399                                 <span class="keywordflow">else</span> {
<a name="l00400"></a>00400                                         state = 4;
<a name="l00401"></a>00401                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#1918d3513feff231a52562cb3536e68a">CAL_PLACE_30</a>;
<a name="l00402"></a>00402                                 }
<a name="l00403"></a>00403                         }
<a name="l00404"></a>00404                 <span class="keywordflow">break</span>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406                 <span class="keywordflow">case</span> 4:
<a name="l00407"></a>00407                         <span class="comment">// 4. Calibration des mesures : mesure de près (30 cm)</span>
<a name="l00408"></a>00408                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre.">measureDistance</a>(addr)) {
<a name="l00409"></a>00409                                 meas30 = <a class="code" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre.">getMeasuredDist</a>(addr);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411                                 state = 5;
<a name="l00412"></a>00412                                 <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#b3b6643ad6e92c76b670f0ad22861d4b">CAL_PLACE_100</a>;
<a name="l00413"></a>00413                         }
<a name="l00414"></a>00414                 <span class="keywordflow">break</span>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416                 <span class="keywordflow">case</span> 5:
<a name="l00417"></a>00417                         <span class="comment">// 5. Calibration des mesures : mesure de loin (1 m)</span>
<a name="l00418"></a>00418                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre.">measureDistance</a>(addr)) {
<a name="l00419"></a>00419                                 meas100 = <a class="code" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre.">getMeasuredDist</a>(addr);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                                 <span class="keywordflow">if</span> (meas30 &gt;= meas100) {
<a name="l00422"></a>00422                                         <span class="comment">// La mesure à 30 cm est identique ou plus grande que celle à 1 m, il y a vraissemblablement un problème !</span>
<a name="l00423"></a>00423                                         state = 0;
<a name="l00424"></a>00424                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#9b77ae51e68ff13de5c3187f9213de63">CAL_ERROR</a>;
<a name="l00425"></a>00425                                 }
<a name="l00426"></a>00426                                 <span class="keywordflow">else</span> {
<a name="l00427"></a>00427                                         <span class="comment">// Nouvelles pente et origine</span>
<a name="l00428"></a>00428                                         slope = (1000.0 - 300.0) / ((meas100 - meas30) / 340.0);
<a name="l00429"></a>00429                                         origin = ((1000.0 + 300.0) - slope * ((meas100 + meas30) / 340.0)) / 2.0;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431                                         slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = (<a class="code" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) slope;
<a name="l00432"></a>00432                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 5, slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00433"></a>00433                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 6, slopeWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435                                         originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#3b0f626d2e15ff5aa21804dd598d23c9">Val</a> = (<a class="code" href="_generic_type_defs_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a>) origin;
<a name="l00436"></a>00436                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 7, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#912b51805454255a794b26e6646c0cf1">HB</a>);
<a name="l00437"></a>00437                                         <a class="code" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&amp;#39;EEPROM du PIC.">WriteEEPROM</a>(8*addr + 8, originWord.<a class="code" href="union___w_o_r_d___v_a_l.html#cdce4917ed4b8de7a7a0c07f21a56141">byte</a>.<a class="code" href="union___w_o_r_d___v_a_l.html#a012d9c31fb3018cbe4d6a5052d98f51">LB</a>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                                         state = 0;
<a name="l00440"></a>00440                                         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#5b3e1e1135d0ee281abc8da6512aeb3f">CAL_DONE</a>;
<a name="l00441"></a>00441                                 }
<a name="l00442"></a>00442                         }
<a name="l00443"></a>00443                 <span class="keywordflow">break</span>;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445                 <span class="keywordflow">default</span>:
<a name="l00446"></a>00446                         state = 0;
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <span class="keywordflow">return</span> <a class="code" href="_pc_interface_8h.html#b3a6812f76031ffc540dce45f0cb296d">CAL_CONTINUE</a>;
<a name="l00450"></a>00450 }
</pre></div>
<p>

<p>
<div class="dynheader">
Voici le graphe d'appel pour cette fonction :</div>
<div class="dynsection">
<p><center><img src="rangefinder_8h_6af556b86bdcad857be2fbe2599bcde4_cgraph.png" border="0" usemap="#rangefinder_8h_6af556b86bdcad857be2fbe2599bcde4_cgraph_map" alt=""></center>
<map name="rangefinder_8h_6af556b86bdcad857be2fbe2599bcde4_cgraph_map">
<area shape="rect" href="rangefinder_8c.html#905b1f6dd68931ac8abb5db4dac699bd" title="Donne la distance mesurée pour un télémètre." alt="" coords="141,5,285,35"><area shape="rect" href="rangefinder_8c.html#7782486c96b2ff62dab69f99636a861e" title="Mesure une distance sur un télémètre." alt="" coords="140,59,287,88"><area shape="rect" href="eeprom_8c.html#23c79775828a6c484c66ba66b42ca847" title="Lit dans l&#39;EEPROM du PIC." alt="" coords="149,112,277,141"><area shape="rect" href="eeprom_8c.html#fd48dcf153304aa7a2726ca1b717ab14" title="Ecrit dans l&#39;EEPROM du PIC." alt="" coords="148,165,279,195"><area shape="rect" href="rangefinder_8c.html#438675a7ef66fd328e56e27a7bff362f" title="Sélection d&#39;un télémètre." alt="" coords="336,32,488,61"><area shape="rect" href="rangefinder_8c.html#6d00149bf7ccb02aed245c211ce25826" title="Envoie une impulsion ultrason." alt="" coords="364,85,460,115"></map>
</div>

</div>
</div><p>
<a class="anchor" name="905b1f6dd68931ac8abb5db4dac699bd"></a><!-- doxytag: member="rangefinder.h::getMeasuredDist" ref="905b1f6dd68931ac8abb5db4dac699bd" args="(char addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long getMeasuredDist           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>addr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Donne la distance mesurée pour un télémètre. 
<p>
<dl compact><dt><b>Paramètres:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>adresse du télémètre (de 0 à 7) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Renvoie:</b></dt><dd>dist distance mesurée (en mm) </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00219"></a>00219                                 {
<a name="l00220"></a>00220         <span class="keywordflow">return</span> <a class="code" href="rangefinder_8c.html#1d1ec60425d21a816cd5d37d80b479c4">MeasuredDist</a>[addr];
<a name="l00221"></a>00221 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6b4d1fc9568f6e793c984abb77701cb8"></a><!-- doxytag: member="rangefinder.h::interruptRangefinder" ref="6b4d1fc9568f6e793c984abb77701cb8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void interruptRangefinder           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fonction d'interruption pour le télémètre. 
<p>
Cette fonction ne doit être appelée que dans une interruption. <div class="fragment"><pre class="fragment"><a name="l00020"></a>00020                                 {
<a name="l00021"></a>00021         <span class="keyword">static</span> <span class="keywordtype">char</span> refVoltage = 15;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <span class="keywordflow">switch</span> (<a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a>) {
<a name="l00024"></a>00024                 <span class="keywordflow">case</span> 1:
<a name="l00025"></a>00025                         <span class="comment">// Réglage du seuil de réception initial</span>
<a name="l00026"></a>00026                         refVoltage = <a class="code" href="rangefinder_8h.html#3afa8280a6e227717cc718148289b948">START_THRESHOLD</a>;
<a name="l00027"></a>00027                         CVRCON = (CVRCON &amp; 0b11110000) | (<a class="code" href="rangefinder_8h.html#3afa8280a6e227717cc718148289b948">START_THRESHOLD</a> &amp; 0b1111);
<a name="l00028"></a>00028 
<a name="l00029"></a>00029                         <span class="comment">// Première période d'attente</span>
<a name="l00030"></a>00030                         <a class="code" href="rangefinder_8c.html#9a77d62c9634567da6c804c4391b3c64">ElapsedTime</a> = 0;                                                <span class="comment">// Mise à 0 du temps de comptage</span>
<a name="l00031"></a>00031                         WriteTimer1(65535 - (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * <a class="code" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041" title="Période de comptage du temps écoulé, pour la réception (en us) [default: 500]...">RCPT_TIMER_PER</a> / 1e6));
<a name="l00032"></a>00032 
<a name="l00033"></a>00033                         PIE2bits.CMIE = 1;                                              <span class="comment">// Activation des interruptions du comparateur</span>
<a name="l00034"></a>00034                         <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 2;
<a name="l00035"></a>00035                 <span class="keywordflow">break</span>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037                 <span class="keywordflow">case</span> 2:
<a name="l00038"></a>00038                         <a class="code" href="rangefinder_8c.html#9a77d62c9634567da6c804c4391b3c64">ElapsedTime</a>++;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef EN_DYN_THRESHOLD</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (refVoltage &gt; <a class="code" href="rangefinder_8h.html#834d53e3b7adf1c8a94e6543e033e290" title="Pas de diminution du seuil, tous les RCPT_TIMER_PER (uniquement avec seuil dynamique)...">THRESHOLD_STEP</a>)
<a name="l00042"></a>00042                                 refVoltage-= <a class="code" href="rangefinder_8h.html#834d53e3b7adf1c8a94e6543e033e290" title="Pas de diminution du seuil, tous les RCPT_TIMER_PER (uniquement avec seuil dynamique)...">THRESHOLD_STEP</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044                         <span class="keywordflow">if</span> (refVoltage &gt;= <a class="code" href="rangefinder_8h.html#a3c9d5bc3f1c3dfec69046200aecb29a">MIN_THRESHOLD</a>)
<a name="l00045"></a>00045                                 CVRCON = (CVRCON &amp; 0b11110000) | (refVoltage &amp; 0b1111);
<a name="l00046"></a>00046 <span class="preprocessor">#endif</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048                         <span class="keywordflow">if</span> (<a class="code" href="rangefinder_8c.html#9a77d62c9634567da6c804c4391b3c64">ElapsedTime</a> &gt;= (<span class="keywordtype">long</span>) (<a class="code" href="rangefinder_8h.html#afcb3658731991cf3037f912d65b64e9" title="Délais d&amp;#39;attente maximale à la réception (en us) [default: 18000].">RCPT_MAX_DELAY</a> / <a class="code" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041" title="Période de comptage du temps écoulé, pour la réception (en us) [default: 500]...">RCPT_TIMER_PER</a>)) {
<a name="l00049"></a>00049                                 <a class="code" href="rangefinder_8c.html#1d1ec60425d21a816cd5d37d80b479c4">MeasuredDist</a>[<a class="code" href="rangefinder_8c.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a>] = (long) (<a class="code" href="rangefinder_8h.html#e73d78f8ad1955fc7efc65b109987632">SOUND_SPEED</a> / 2.0 * (<a class="code" href="rangefinder_8c.html#9a77d62c9634567da6c804c4391b3c64">ElapsedTime</a> * <a class="code" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041" title="Période de comptage du temps écoulé, pour la réception (en us) [default: 500]...">RCPT_TIMER_PER</a>) / 1000.0) + <a class="code" href="rangefinder_8h.html#1798dcdbfe664345eadd340c38ca4a34">MEAS_OFFSET</a>;
<a name="l00050"></a>00050                                 PIE2bits.CMIE = 0;                                              <span class="comment">// Désactivation des interruptions du comparateur</span>
<a name="l00051"></a>00051                                 <a class="code" href="rangefinder_8h.html#0d30fcd95933784ad82131355571f495" title="Signal ENABLE du circuit de réception.">RCPT_EN</a> = 0;                                                    <span class="comment">// Désactivation du circuit de réception</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053                                 <span class="comment">// Délais avant de passer au télémètre suivant</span>
<a name="l00054"></a>00054                                 WriteTimer1(65535 - (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * <a class="code" href="rangefinder_8h.html#2b507902afdd3115802269d47bdfff22" title="Délais avant de passer au télémètre suivant (en us) [default: 100].">DELAY_RCPT</a> / 1e6));
<a name="l00055"></a>00055                                 <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 3;
<a name="l00056"></a>00056                         }
<a name="l00057"></a>00057                         <span class="keywordflow">else</span>
<a name="l00058"></a>00058                                 WriteTimer1(65535 - (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * RCPT_TIMER_PER / 1e6));
<a name="l00059"></a>00059                 <span class="keywordflow">break</span>;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061                 <span class="keywordflow">case</span> 3:
<a name="l00062"></a>00062                         <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 4;
<a name="l00063"></a>00063                 <span class="keywordflow">break</span>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065                 <span class="keywordflow">default</span>:
<a name="l00066"></a>00066                 <span class="keywordflow">break</span>;
<a name="l00067"></a>00067         }
<a name="l00068"></a>00068 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="efe3164ab7224e74c49438f63c56caa2"></a><!-- doxytag: member="rangefinder.h::interruptRangefinder2" ref="efe3164ab7224e74c49438f63c56caa2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void interruptRangefinder2           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fonction d'interruption pour le télémètre. 
<p>
Cette fonction ne doit être appelée que dans une interruption. <div class="fragment"><pre class="fragment"><a name="l00074"></a>00074                                  {
<a name="l00075"></a>00075         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> time = ReadTimer1();               <span class="comment">// On lit tout de suite le timer1 pour éviter les erreurs</span>
<a name="l00076"></a>00076                                                                                         <span class="comment">// et un overflow dans le cas limite !</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (CMCONbits.C1OUT == 1 &amp;&amp; <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> == 2) {
<a name="l00079"></a>00079                 time-= (65535 - (<span class="keywordtype">unsigned</span> int) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * <a class="code" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041" title="Période de comptage du temps écoulé, pour la réception (en us) [default: 500]...">RCPT_TIMER_PER</a> / 1e6));
<a name="l00080"></a>00080 
<a name="l00081"></a>00081                 <a class="code" href="rangefinder_8c.html#1d1ec60425d21a816cd5d37d80b479c4">MeasuredDist</a>[<a class="code" href="rangefinder_8c.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a>] = (long) (<a class="code" href="rangefinder_8h.html#e73d78f8ad1955fc7efc65b109987632">SOUND_SPEED</a> / 2.0 * (<a class="code" href="rangefinder_8c.html#9a77d62c9634567da6c804c4391b3c64">ElapsedTime</a> * <a class="code" href="rangefinder_8h.html#f3860d3c90ead4844e530b8cff74a041" title="Période de comptage du temps écoulé, pour la réception (en us) [default: 500]...">RCPT_TIMER_PER</a>) / 1000.0) + <a class="code" href="rangefinder_8h.html#1798dcdbfe664345eadd340c38ca4a34">MEAS_OFFSET</a>;
<a name="l00082"></a>00082                 <a class="code" href="rangefinder_8c.html#1d1ec60425d21a816cd5d37d80b479c4">MeasuredDist</a>[<a class="code" href="rangefinder_8c.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a>]+= (long) (<a class="code" href="rangefinder_8h.html#e73d78f8ad1955fc7efc65b109987632">SOUND_SPEED</a> / 2.0 * (time / <a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * 1000.0));
<a name="l00083"></a>00083                 PIE2bits.CMIE = 0;                                              <span class="comment">// Désactivation des interruptions du comparateur</span>
<a name="l00084"></a>00084                 <a class="code" href="rangefinder_8h.html#0d30fcd95933784ad82131355571f495" title="Signal ENABLE du circuit de réception.">RCPT_EN</a> = 0;                                                    <span class="comment">// Désactivation du circuit de réception</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086                 <span class="comment">// Délais avant de passer au télémètre suivant</span>
<a name="l00087"></a>00087                 WriteTimer1(65535 - (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * <a class="code" href="rangefinder_8h.html#2b507902afdd3115802269d47bdfff22" title="Délais avant de passer au télémètre suivant (en us) [default: 100].">DELAY_RCPT</a> / 1e6));
<a name="l00088"></a>00088                 <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 3;
<a name="l00089"></a>00089         }
<a name="l00090"></a>00090 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7782486c96b2ff62dab69f99636a861e"></a><!-- doxytag: member="rangefinder.h::measureDistance" ref="7782486c96b2ff62dab69f99636a861e" args="(char addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_generic_type_defs_8h.html#54d65c7fa62e62c9754371e42f5111b9">BOOL</a> measureDistance           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>addr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Mesure une distance sur un télémètre. 
<p>
<dl compact><dt><b>Paramètres:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>adresse du télémètre (de 0 à 7) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Renvoie:</b></dt><dd>status renvoie <a class="el" href="_generic_type_defs_8h.html#fbf708854fe02af8475a9ba02f3196cba82764c3079aea4e60c80e45befbb839">TRUE</a> si la mesure est terminée et <a class="el" href="_generic_type_defs_8h.html#fbf708854fe02af8475a9ba02f3196cba1e095cc966dbecf6a0d8aad75348d1a">FALSE</a> sinon </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00098"></a>00098                                 {
<a name="l00099"></a>00099         <span class="keywordflow">switch</span> (<a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a>) {
<a name="l00100"></a>00100                 <span class="keywordflow">case</span> 0:
<a name="l00101"></a>00101                         <span class="comment">// Sélection du télémètre et émission de la trame</span>
<a name="l00102"></a>00102                         <a class="code" href="rangefinder_8c.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a> = addr;
<a name="l00103"></a>00103                         <a class="code" href="rangefinder_8c.html#438675a7ef66fd328e56e27a7bff362f" title="Sélection d&amp;#39;un télémètre.">selectRangefinder</a>(addr);                        <span class="comment">// Sélection du télémètre</span>
<a name="l00104"></a>00104                         <a class="code" href="rangefinder_8c.html#6d00149bf7ccb02aed245c211ce25826" title="Envoie une impulsion ultrason.">sendPulse</a>();                                                    <span class="comment">// Envoie de l'impulsion</span>
<a name="l00105"></a>00105                         <a class="code" href="rangefinder_8h.html#0d30fcd95933784ad82131355571f495" title="Signal ENABLE du circuit de réception.">RCPT_EN</a> = 1;                                                    <span class="comment">// Activation du circuit de réception</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                         <span class="comment">// Délais avant la prise en compte du signal à la réception</span>
<a name="l00108"></a>00108                         WriteTimer1(65535 - (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<a class="code" href="rangefinder_8h.html#08424215b748fd2db22798a03fd47330">CYCLE_FREQ</a> * <a class="code" href="rangefinder_8h.html#97afb20d1630e78fe4a72dd53bf03c92">DELAY_PULSE</a> / 1e6));
<a name="l00109"></a>00109                         <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 1;
<a name="l00110"></a>00110                 <span class="keywordflow">break</span>;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112                 <span class="keywordflow">case</span> 1:
<a name="l00113"></a>00113                         <span class="comment">// Activation de la réception</span>
<a name="l00114"></a>00114                 <span class="keywordflow">case</span> 2:
<a name="l00115"></a>00115                         <span class="comment">// Attente réception</span>
<a name="l00116"></a>00116                 <span class="keywordflow">case</span> 3:
<a name="l00117"></a>00117                         <span class="comment">// Réception ou délais de réception dépassé</span>
<a name="l00118"></a>00118                 <span class="keywordflow">break</span>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                 <span class="keywordflow">case</span> 4:
<a name="l00121"></a>00121                         <span class="comment">// Mesure télémètre suivant</span>
<a name="l00122"></a>00122                         <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 0;
<a name="l00123"></a>00123                         <span class="keywordflow">return</span> <a class="code" href="_generic_type_defs_8h.html#fbf708854fe02af8475a9ba02f3196cba82764c3079aea4e60c80e45befbb839">TRUE</a>;
<a name="l00124"></a>00124                 <span class="keywordflow">break</span>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126                 <span class="keywordflow">default</span>:
<a name="l00127"></a>00127                         <a class="code" href="rangefinder_8c.html#074e3d92a38b41777319b1d184ea9a68">State</a> = 0;
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">return</span> <a class="code" href="_generic_type_defs_8h.html#fbf708854fe02af8475a9ba02f3196cba1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;
<a name="l00131"></a>00131 }
</pre></div>
<p>

<p>
<div class="dynheader">
Voici le graphe d'appel pour cette fonction :</div>
<div class="dynsection">
<p><center><img src="rangefinder_8h_7782486c96b2ff62dab69f99636a861e_cgraph.png" border="0" usemap="#rangefinder_8h_7782486c96b2ff62dab69f99636a861e_cgraph_map" alt=""></center>
<map name="rangefinder_8h_7782486c96b2ff62dab69f99636a861e_cgraph_map">
<area shape="rect" href="rangefinder_8c.html#438675a7ef66fd328e56e27a7bff362f" title="Sélection d&#39;un télémètre." alt="" coords="203,5,355,35"><area shape="rect" href="rangefinder_8c.html#6d00149bf7ccb02aed245c211ce25826" title="Envoie une impulsion ultrason." alt="" coords="231,59,327,88"></map>
</div>

</div>
</div><p>
<a class="anchor" name="00ea98b79ae4bcb70342d4389d33ae31"></a><!-- doxytag: member="rangefinder.h::quickSelect" ref="00ea98b79ae4bcb70342d4389d33ae31" args="(long arr[], int n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long quickSelect           </td>
          <td>(</td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>arr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00459"></a>00459                                     {
<a name="l00460"></a>00460         <span class="keywordtype">int</span> low, high ;
<a name="l00461"></a>00461         <span class="keywordtype">int</span> median;
<a name="l00462"></a>00462         <span class="keywordtype">int</span> middle, ll, hh;
<a name="l00463"></a>00463         low = 0 ; high = n-1 ; median = (low + high) / 2;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="keywordflow">for</span> (;;) {
<a name="l00466"></a>00466                 <span class="keywordflow">if</span> (high &lt;= low) <span class="comment">/* One element only */</span>
<a name="l00467"></a>00467                         <span class="keywordflow">return</span> arr[median] ;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469                 <span class="keywordflow">if</span> (high == low + 1) { <span class="comment">/* Two elements only */</span>
<a name="l00470"></a>00470                         <span class="keywordflow">if</span> (arr[low] &gt; arr[high])
<a name="l00471"></a>00471                                 <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[low], arr[high]) ;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473                         <span class="keywordflow">return</span> arr[median] ;
<a name="l00474"></a>00474                 }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                 <span class="comment">/* Find median of low, middle and high items; swap into position low */</span>
<a name="l00477"></a>00477                 middle = (low + high) / 2;
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> (arr[middle] &gt; arr[high]) <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[middle], arr[high]) ;
<a name="l00479"></a>00479                 <span class="keywordflow">if</span> (arr[low] &gt; arr[high]) <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[low], arr[high]) ;
<a name="l00480"></a>00480                 <span class="keywordflow">if</span> (arr[middle] &gt; arr[low]) <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[middle], arr[low]) ;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482                 <span class="comment">/* Swap low item (now in position middle) into position (low+1) */</span>
<a name="l00483"></a>00483                 <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[middle], arr[low+1]) ;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485                 <span class="comment">/* Nibble from each end towards middle, swapping items when stuck */</span>
<a name="l00486"></a>00486                 ll = low + 1;
<a name="l00487"></a>00487                 hh = high;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489                 <span class="keywordflow">for</span> (;;) {
<a name="l00490"></a>00490                         <span class="keywordflow">do</span> ll++; <span class="keywordflow">while</span> (arr[low] &gt; arr[ll]) ;
<a name="l00491"></a>00491                         <span class="keywordflow">do</span> hh--; <span class="keywordflow">while</span> (arr[hh] &gt; arr[low]) ;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493                         <span class="keywordflow">if</span> (hh &lt; ll)
<a name="l00494"></a>00494                                 <span class="keywordflow">break</span>;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496                         <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[ll], arr[hh]) ;
<a name="l00497"></a>00497                 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499                 <span class="comment">/* Swap middle item (in position low) back into correct position */</span>
<a name="l00500"></a>00500                 <a class="code" href="rangefinder_8c.html#85a69dd703a28a51142294036a464907" title="This Quickselect routine is based on the algorithm described in &amp;quot;Numerical recipes...">ELEM_SWAP</a>(arr[low], arr[hh]) ;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502                 <span class="comment">/* Re-set active partition */</span>
<a name="l00503"></a>00503                 <span class="keywordflow">if</span> (hh &lt;= median)
<a name="l00504"></a>00504                         low = ll;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506                 <span class="keywordflow">if</span> (hh &gt;= median)
<a name="l00507"></a>00507                         high = hh - 1;
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="438675a7ef66fd328e56e27a7bff362f"></a><!-- doxytag: member="rangefinder.h::selectRangefinder" ref="438675a7ef66fd328e56e27a7bff362f" args="(char addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void selectRangefinder           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>addr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sélection d'un télémètre. 
<p>
Cette fonction permet de sélectionner un télémètre pour l'émission et la réception.<p>
<dl compact><dt><b>Paramètres:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>adresse du télémètre (de 0 à 7) </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment"><a name="l00139"></a>00139                                   {
<a name="l00140"></a>00140         <a class="code" href="rangefinder_8h.html#bd6756ef3ae5fbf8778baa708a874027" title="Bit 0 d&amp;#39;adresse du télémètre.">ADDR0</a> = addr &amp; 1;
<a name="l00141"></a>00141         <a class="code" href="rangefinder_8h.html#9897c4845eb36c5242bfeb12bba79d5c" title="Bit 1 d&amp;#39;adresse du télémètre.">ADDR1</a> = (addr &gt;&gt; 1) &amp; 1;
<a name="l00142"></a>00142         <a class="code" href="rangefinder_8h.html#f72b69397a00971f5f6ee4b2ac5a4735" title="Bit 2 d&amp;#39;adresse du télémètre.">ADDR2</a> = (addr &gt;&gt; 2) &amp; 1;
<a name="l00143"></a>00143 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6d00149bf7ccb02aed245c211ce25826"></a><!-- doxytag: member="rangefinder.h::sendPulse" ref="6d00149bf7ccb02aed245c211ce25826" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendPulse           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Envoie une impulsion ultrason. 
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Cette fonction bloque le programme durant l'envoie de l'impulsion. Cela est nécessaire pour que la fréquence de la trame émise soit à peu prêt maitrisée. </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00150"></a>00150                      {
<a name="l00151"></a>00151         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <a class="code" href="rangefinder_8h.html#70c5ad4e1fc5bcfafdc0f64434fb1c8f" title="Signal ENABLE du circuit d&amp;#39;émission.">EM_EN</a> = 1;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 _asm
<a name="l00156"></a>00156         movlw <a class="code" href="rangefinder_8h.html#185b4dd6ffe8f2446d26cde1a059f740" title="Nombre de périodes dans la trame d&amp;#39;émission [default: 10].">MAX_PULSE</a>
<a name="l00157"></a>00157         movwf i, 0
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         loop:
<a name="l00160"></a>00160                 dcfsnz i, 1, 0
<a name="l00161"></a>00161                 <span class="keywordflow">goto</span> done
<a name="l00162"></a>00162                 bsf PORTD, 5, 0                                                                 <span class="comment">// PULSE à 1</span>
<a name="l00163"></a>00163                 nop nop nop nop nop nop nop nop nop nop                 <span class="comment">// 10 NOP par ligne</span>
<a name="l00164"></a>00164                 nop nop nop nop nop nop nop nop nop nop
<a name="l00165"></a>00165                 nop nop nop nop nop nop nop nop nop nop
<a name="l00166"></a>00166                 nop nop nop nop nop nop nop nop nop nop
<a name="l00167"></a>00167                 nop nop nop nop nop nop nop nop nop nop
<a name="l00168"></a>00168                 nop nop nop nop nop nop nop nop nop nop
<a name="l00169"></a>00169                 nop nop nop nop nop nop nop nop nop nop
<a name="l00170"></a>00170                 nop nop nop nop nop nop nop nop nop nop
<a name="l00171"></a>00171                 nop nop nop nop nop nop nop nop nop nop
<a name="l00172"></a>00172                 nop nop nop nop nop nop nop nop nop nop
<a name="l00173"></a>00173                 nop nop nop nop nop nop nop nop nop nop
<a name="l00174"></a>00174                 nop nop nop nop nop nop nop nop nop nop
<a name="l00175"></a>00175                 nop nop nop nop nop nop nop nop nop nop
<a name="l00176"></a>00176                 nop nop nop nop nop nop nop nop nop nop
<a name="l00177"></a>00177                 nop nop nop nop nop nop nop nop nop                             <span class="comment">// 150 cycles - 1 pour "bsf PORTD, 5, 0"</span>
<a name="l00178"></a>00178                 bcf PORTD, 5, 0                                                                 <span class="comment">// PULSE à 0</span>
<a name="l00179"></a>00179                 nop nop nop nop nop nop nop nop nop nop                 <span class="comment">// 10 NOP par ligne</span>
<a name="l00180"></a>00180                 nop nop nop nop nop nop nop nop nop nop
<a name="l00181"></a>00181                 nop nop nop nop nop nop nop nop nop nop
<a name="l00182"></a>00182                 nop nop nop nop nop nop nop nop nop nop
<a name="l00183"></a>00183                 nop nop nop nop nop nop nop nop nop nop
<a name="l00184"></a>00184                 nop nop nop nop nop nop nop nop nop nop
<a name="l00185"></a>00185                 nop nop nop nop nop nop nop nop nop nop
<a name="l00186"></a>00186                 nop nop nop nop nop nop nop nop nop nop
<a name="l00187"></a>00187                 nop nop nop nop nop nop nop nop nop nop
<a name="l00188"></a>00188                 nop nop nop nop nop nop nop nop nop nop
<a name="l00189"></a>00189                 nop nop nop nop nop nop nop nop nop nop
<a name="l00190"></a>00190                 nop nop nop nop nop nop nop nop nop nop
<a name="l00191"></a>00191                 nop nop nop nop nop nop nop nop nop nop
<a name="l00192"></a>00192                 nop nop nop nop nop nop nop nop nop nop
<a name="l00193"></a>00193                 nop nop nop nop nop nop nop                                             <span class="comment">// 150 cycles - 3 pour "bcf PORTD, 5, 0", "bra loop" et "dcfsnz i, 1, 0"</span>
<a name="l00194"></a>00194                 bra loop
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         done:
<a name="l00197"></a>00197 _endasm
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">/*</span>
<a name="l00201"></a>00201 <span class="comment"></span>
<a name="l00202"></a>00202 <span class="comment">        for (i = 0; i &lt; MAX_PULSE; i++) {</span>
<a name="l00203"></a>00203 <span class="comment">                PULSE = 1;</span>
<a name="l00204"></a>00204 <span class="comment">                Delay10TCYx(15);                                                        // attends 150 cycles</span>
<a name="l00205"></a>00205 <span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment">                PULSE = 0;</span>
<a name="l00207"></a>00207 <span class="comment">                Delay10TCYx(15);                                                        // attends 150 cycles</span>
<a name="l00208"></a>00208 <span class="comment">        }</span>
<a name="l00209"></a>00209 <span class="comment">*/</span>
<a name="l00210"></a>00210         <a class="code" href="rangefinder_8h.html#70c5ad4e1fc5bcfafdc0f64434fb1c8f" title="Signal ENABLE du circuit d&amp;#39;émission.">EM_EN</a> = 0;
<a name="l00211"></a>00211 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Documentation des variables</h2>
<a class="anchor" name="dfbb1490177a645ec1cc8b0c94ae63aa"></a><!-- doxytag: member="rangefinder.h::Rangefinder" ref="dfbb1490177a645ec1cc8b0c94ae63aa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile char <a class="el" href="rangefinder_8h.html#dfbb1490177a645ec1cc8b0c94ae63aa">Rangefinder</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Généré le Sat Feb 14 20:09:22 2009 pour Carte capteurs par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
